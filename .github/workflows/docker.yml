---
name: 'Build Docker images'

on:
  push:
  # schedule:
  #   - cron: '0 4 * * *'

permissions: # least privileges, see https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#permissions
  contents: read
  actions: read

jobs:
  call-build-image-auth:
    uses: romeroalx/pdns/.github/workflows/build-docker-images.yml@build-docker-images-dev
    with:
      product: auth
      ref: ${{ github.ref_name }}
      image-name: powerdns-auth-master
      image-tags: |
        test
        latest
      platforms: linux/amd64,linux/arm64/v8
      push: false

  call-build-image-recursor:
    uses: romeroalx/pdns/.github/workflows/build-docker-images.yml@build-docker-images-dev
    with:
      product: recursor
      ref: ${{ github.ref_name }}
      image-name: powerdns-recursor-master
      image-tags: |
        test
        latest
      platforms: linux/amd64,linux/arm64/v8
      push: false

  call-build-image-dnsdist:
    uses: romeroalx/pdns/.github/workflows/build-docker-images.yml@build-docker-images-dev
    with:
      product: dnsdist
      ref: ${{ github.ref_name }}
      image-name: powerdns-dnsdist-master
      image-tags: |
        test
        latest
      platforms: linux/amd64,linux/arm64/v8
      push: false
